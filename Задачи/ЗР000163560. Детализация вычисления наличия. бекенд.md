#### Параметры:

## Вопросы:
**Причины недоступности**:
1) Сократить название недоступности: Ограничения на поставку количества мягких остатков в филиал.
2) Пункты 3 и 4 лишь подчастные случаи отсутствия мягкого остатка как такового на складе отправителе.
	1. Ограничения на поставку количества мягких остатков в филиал 
	2. Ограничение по габаритам для филиала 
	3. У филиала заблокировали жёсткие остатки, так как был задействован маршрут в филиал с мягким резервом 
	4. У филиала всё в мягком резерве
3) Если будем обьединять 3 и 4 причины, то перефразировать "Нет мягкого остатка" на "Нет доступного мягкого остатка".
## Задача:
### Цель:
Получить информацию о мягких остатках для диагностики проблем с остатками или маршрутами товара.
### Аббревиатуры и сокращения:
- Мягкие остатки - товары, которые можно привезти из другого склада.
- ТВП - товар в пути
- Мягкий резерв - алгоритм, который обходит другие склады и забирает жесткие остатки при наличии отрицательного остатка на своем складе. Подробнее в https://confluence.dns-shop.ru/pages/viewpage.action?pageId=105868088
### Описание:
Таблица мягких остатков необходима для диагностики проблем с остатками или маршрутами товара для проверки расхождения данных на сайте и в 1С.
#### Расположение таблицы
Поиск товара происходит в "Проверка товара":
https://backend.dns-shop.ru/productCheck/product-check/check
![[Pasted image 20240918101221.png]]
**Таблица должна находиться по адресу ниже** с переданными туда параметрами из Проверки товара. Пример запроса:
https://backend.dns-shop.ru/productCheck/product-check/soft-avails/?s%5BproductGuid%5D=c9aadb6c-26fc-4aad-bb33-59194aa74bd5&s%5BsiteGuid%5D=8c2e120b-8732-48a7-8178-0e04d47962d8&s%5BcityGuid%5D=cd1f0fe1-3292-11e1-9afa-001517c526f0
#### Убрать из поиска мягких остатков сайт
Оставить только Гуид товара и Город.
Сайт всегда **по умолчанию ставить DNS.**
![[Pasted image 20240918093932.png]]
#### Добавить фильтр
Множественный выбор из списка складов-получателей.
Склады-получатели формируются относительно выбранного города.
#### Вывод данных в таблицу
- **Если сладов-получателей** в городе **меньше или равно 5, то выводить данные о маршрутах** в таблицу **по умолчанию**.
- **Если складов-получателей** в городе **больше 5, то НЕ выводить данные о маршрутах** в таблицу **по умолчанию**.
  **Для получения данных** в таблицу **необходимо выбрать один или более складов получателей**.
#### Выделение данных цветом
- **Если мягкие остатки есть** на маршруте, то выделять строку **зеленым цветом**.
- **Если мягких остатков НЕТ** на маршруте, то выделять строку **красным цветом**.
#### Данные в таблице
Таблица должна выводить:
- Склад получатель. Выводить название
- Склад отправитель. Выводить название
- Количество товара на складе-отправителе
- количество ТВП
- Причины недоступности. Подразумевать, что причин может быть несколько на одном маршруте. Все **причины недоступности**:
	- **Нет мягких остатков**. 
	- **Ограничение продажи.** Есть определенный список товаров, которые не имеют мягких остатков.
	- **Размер габаритов превышен.** 
	- **Жёсткие остатки заблокированы**
	- **Остатки в мягком резерве**
#### Контракт метода детализации
Получение детализации производится по следующему API:
**Входные данные**
```json
	{
		"pid": "guid#123",
		"cid": "guid#343",
		"bids": [
			"guid#1"
		]
	}
```
Где:
- `pid` - guid товара
- `cid` - guid города
- `bids` - guid'ы филиалов (необязательный параметр)
**Выходные данные**
```json
{
	"routes": [
		{
			"xbid": "guid#2",
			"ybid": "guid#1",
			"is_way": false,
			"count": 5,
			"time": "2002-10-02T15:00:00Z",
			"issues": [
				"Размер габаритов превышен"
			]
		}
	]
}
```
Где:
- `xbid` - филиал-отправитель
- `ybid` - филиал-получатель
- `is_way` - является ли маршрут ТВП
- `count` - кол-во мягких остатков
- `time` - время поставки на филиал-получатель
- `issues` - причины, по которым мягкие остатки нельзя получить