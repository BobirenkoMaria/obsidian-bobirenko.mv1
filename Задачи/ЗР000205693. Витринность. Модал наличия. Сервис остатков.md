#### Параметры:
date-end:: 2024-09-02
## Вопросы
1) В чем отличие витринных образцов и последнего экземпляра от обычного товара
2) Где и как помечаются витринные образцы в системе
3) Что такое РРЦ и ТП. Где ознакомиться
4) Где должна быть расположена кнопка активации безвитринности в корзине
5) с розничных магазинов нет доставки?
6) `что меняется после перехода с "Получить товар со склада" на "Скрыть витринные образцы"` Это значит заменить кнопку "Получить товары со склада" на "Скрыть витринные образцы"? Или добавить еще одну кнопку, чтобы были обе?
7) `- в случае с мягким резервом логика не меняется, только заказ с ТП/РРЦ` а какая сейчас логика
8) Что такое псевдоссылки
9) получить со склада и убрать витринные образцы приводят к одному результату? Если нет, то в чем отличия
10) На РРЦ и ТП есть витринные образцы? О: нет
11) Где происходит фильтрация: на бэке фронта или на сервисе остатков?
12) общее правило: фильтр должен влиять не на товары, а на наличие товаров. В чем разница товаров и наличия товаров в этом контексте?
13) Уточнение формулировки 
	3) на филиале **есть** остатки, **все витринные**
		- при наличии остатков на РРЦ или ТП с доступной логистикой, где есть невитринный образец - показывать что можно привести под заказ, пример: при заказе: завтра (c 14:30)
		- если нет доступных остатков на РРЦ или ТП с доступной логистикой - показывать по аналогии с "нет в наличии", формулировка может быть "только на витрине"


## Use Case Фильтрации витринных образцов
1) Пользователь заходит на сайт
2) Пользователь открывает карточку товара. 
   [[#Use Case Добавления товара в корзину пользователя]]
3) Пользователь переходит в корзину
   [[#Use Case Корзины]]
4) Оформление заказа 
   [[#Use Case Оформление заказа не витринных образцов]]

## Use Case Добавления товара в корзину пользователя
1) Пользователь добавляет товар в корзину
   - Поступления товара в корзину с включенным checkbox "Скрыть витринные образцы" в модальном окне наличия  - **AF1** 
   - Поступление товара в корзину через модальное окно наличия - **AF2** 
   - Поступление товара в корзину - **AF3**
3) Система добавляет товар в корзину пользователя
   
- **AF1** - Поступления товара в корзину с включенным checkbox "Скрыть витринные образцы" в модальном окне наличия
	1) Пользователь открывает модальное окно наличия
	2) Пользователь ставит галочку в checkbox "Скрыть витринные образцы"
	3) Модальное окно наличия:
		- показывает количество товара если все не витринные - **AF1.1**
		- показывает количество товара с вычетом всех витринных образцов - **AF1.2**
		- показывает возможность доставки если есть только витринные образцы - **AF1.3**
		- показывает возможность доставки если нет остатков вообще - **AF1.4**
	4) Пользователь нажимает кнопку "Купить"
	
	- **AF1.1** - Отображение количества при наличии только не витринных жестких остатков
		1) Модульное окно отображает все жесткие остатки
	- **AF1.2** - Отображение количества при наличии жестких остатков
		1) Остатки показываются с вычетом количества витринных образцов
	- **AF1.3** - Отображение доставки при доступных мягких остатках
		Предусловие: на филиале есть только витринные образцы и доступны мягкие остатки.
		1) Система проверяет наличие доступных ==не витринных остатков в РРЦ и ТП==
		2) Модальное окно наличия выводит доступную доставку.
	- **AF1.4** - Отображение при отсутствии остатков
		1) Модальное окно наличия выводит "Нет в наличии", либо "Только на витрине"
- **AF2** - Поступление товара в корзину через модальное окно наличия
	1) Пользователь открывает модальное окно наличия
	2) Пользователь нажимает кнопку "Купить"
- **AF3** - Поступление товара в корзину
	1) Пользователь нажимает кнопку "Купить"
## Use Case Корзины
1) Пользователь активирует переключатель "Скрыть витринные образцы"
	-  Оформление заказа одного товара в единичном количестве
	   - Диаграмма: https://www.plantuml.com/plantuml/uml/jLNDRjD04BxxAKRDkLoA8a4bL5w02rSavDXROc4Sb7KelPKYJbGY50mHbF0Z92v8bDAKABJX5MRVYC-xnd8rMGGIkQpZRxwVcUnkig7pi9yFxgH1dkIf2dYVn_oI3x2-u3TOt_C7_apybj_n2AzFyIm05IYE-0i1UcvvptXCmCSm688p9DudBb0SMUOdIpeWVeN7QmiKfJVe1Q46_aUWPMM8jGXK5hkEWe5MKQWLhO0sCRl4HppdxtoAzOJFU6uUc5sUqesC-AVPuIdmhtXEAXpB7993ixD2eQRDC4cfrGdRQ-srzLpTpozlTPDShJTYYb9fzcIGW_yoI0-YI6bDhRjXgcxrbSfSN2SDezl_A-w7sUCPpnq9xyV4nqx9X_2RcOUsbrYboJtLtwPM-sAxSobg31uiwkIaIfaXTKA_3HrW3RjXFvP2sTCHJr50ynZep3pscztiPUdszMvlgtIKpekSt9xZTV8lERhAk9h5rtgPJFJFuW_o3jHC24gKLbUlo7cR9TcY9Fdi1MhfzK5CaqnTY4FTLN7W3_AB5XwLK_E4l_aFYkvjvl86roBpwBm85yZAChG3PMEgyzsXvYdLokg31TsbbwFuDrnkj6-w9PrSaREiaok2vD7IrVSevwrBtXO5ITeBLy-UUIESelwL4ogH-GVwXifY_1t-0W00
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет жесткий не витринный остаток - **AF1**
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет жесткий витринный остаток и жесткий не витринный остаток - **AF1**
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет только жесткий витринный остаток и не имеет мягких остатков - **AF2**
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет только жесткий витринный остаток и имеет только мягкие витринные остатки - **AF2**
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет только жесткий витринный остаток и имеет мягкие витринные и не витринные остатки - **AF3
	   - Оформление заказа одного товара в единичном количестве, где филиал имеет только жесткий витринный остаток и имеет мягкие не витринные остатки - **AF3**
	- Оформление заказа одного товара в не единичном количестве 
2) Пользователь оформляет заказ

## Use Case Оформление заказа не витринных образцов
Предусловие: пользователь выбрал верный пункт выдачи
1) Пользователь убеждается в способе получения
	- Диаграмма: https://www.plantuml.com/plantuml/uml/fLJDRjD04BxxAKRjkU5G58csYYfnH9ou8bMEiqeiZ8DgH-MOE9GAfL8bJXn05MyGGaoN90slCFj6VBDhWnsv1yJ1zkxipFTzyxC-JLB_F1szZeXlUSjhCpLNdFCzQyu97xmMh4rcngonlJSpSqbm_0R3dE_CUwmNnBzix3NVoPRd9WF66iy6uN0tx_2CUGERmzO4rpclyE3hUQD41NwYQ8-_2fQP20MzZ85SLsLkn0gE77XGmp_to4_ex2mP1O5A4jf_uqUgVwvKV9ogj-bHD_A3LySLWYy04lsNU2zPGzIs1Zb5ijTcKX8HH48xP6evBDYw0ANzhjy-R1ywdej1cAegpoU4R0hHG1GqIGl86TutHObTYdDRJNZ34wk291ZuSL_HVljnk_iagD5uQPX6Yax23jyY8kSbT4zuRSiFt2Eqiw4bs2CbColQjwuL4aBC5B9M9dDEIqHTiJvv57ReWHOrzCUA7tPJFup3kFzSfODXhnByiMGNKk6Pe0ecAqIEpSp6-r7qB8nxoSE1JQC9KtKq2wnucBuO32y4nlDsXD71GUSFMUDXBHeRaV8PB3z0kIMXGaSdCaLMILxssgN3skhDq7gnRD6DXOtvK5uotZJE6R4crrW0e2D8TEngvAhSF3XDPIb63d2PkDgIoFW-bOpArAdL-cii5pR_SjQZC5QjdfyCLEz_ww3Bcr6fmR-dux1HAdT6GcshXI4ND_uENVYii74tojsdtRohPhUivEuCEzbxbPaGl-hVf-Pugk8UVgs_0G00
	- Выбраны все товары - **AF1**
	- Выбраны не витринные образцы - **AF2**
2) Пользователь продолжает оформлять покупку

## Модальное окно наличия
нужно чтоб был checkbox "скрыть витринные образцы"
![[Pasted image 20240805153003.png]]
При активации "скрыть витринные образцы" остатки должны выдавать значения с вычетом витринных образцов
Логика работы кнопки "скрыть витринные образцы". нужно чтоб чекбоксы учитывали друг друга
![[Pasted image 20240805163117.png]]

Путь реквеста internal\app\components\request.go
Путь структура ответа protos\protobuf\legacy\legacy.go
Путь примера ответа: ![[shops-avail-by-partition.json]]

Надо добавить в параметры реквеста значение 


---

## Контракт
### /v1/avail

Определяет, когда данное кол-во товаров будет доступно на филиалах.
Параметр _dl_ включает дисконтную логистику.
Параметр wrapped включает фильтрацию витринных образцов:
- при значении **false** - метод возвращает количество витринных и невитринных остатков.
- при значении **true**:
	-  метод возвращает кол-во доступного жесткого невитринного остатка.
	-  метод возвращает кол-во доступного мягкого невитринного остатка.
*При установке true для обоих параметров метод выдаст ошибку!*

В ответе параметр _when_ содержит дату-время когда товар будет доступен на филиале. Время локальное для филиала. _when_ может принимать значения **-** (никогда) и **now** (сейчас). В _branches_ содержится когда вся группа товаров будет доступна на филиалах. В _products_ содержится когда каждый из товаров в отдельности будет доступен на каждом из филиалов. Свойство _maxCount_ содержит максимальное кол-во товара, которое может быть доставлено к этому времени, а _hardCount_ это кол-во жесткого остатка товара на филиале в данный момент.
Предполагается, что все филиалы находятся в одном городе. Можно и в разных городах, но будет неправильно вычислено ограничение на перевозку акционных товаров.
### Пример
Запрос:
GET [http://in-stock-master.hc-k8s.dns-shop.ru/v1/avail](http://in-stock-master.hc-k8s.dns-shop.ru/v1/avail) 
```
{
  "branchIds": [
    "b7e1e4c4-34ae-4742-87c3-87d8ca3d8ce6",
    "74233664-bb9e-11da-ab47-0002b3552d75",
    "2dd57b95-8f47-467a-8e68-26b65d678552"
  ],
  "products": {
    "2b30a423-175b-11eb-a211-00155d03332b": 4,
    "58c57cdd-0713-11df-9cf0-00151716f9f5": 20
  },
  "dl": false,
  "wrapped": false
}
```

Ответ:

```
{
  "avail": {
    "branches": {
      "2dd57b95-8f47-467a-8e68-26b65d678552": {
        "when": "-"
      },
      "74233664-bb9e-11da-ab47-0002b3552d75": {
        "when": "now"
      },
      "b7e1e4c4-34ae-4742-87c3-87d8ca3d8ce6": {
        "when": "2021-06-08 14:00:00 +1000"
      }
    },
    "products": {
      "2b30a423-175b-11eb-a211-00155d03332b": {
        "branches": {
          "2dd57b95-8f47-467a-8e68-26b65d678552": {
            "when": "2021-06-08 01:15:00 +1000",
            "hardCount": 2,
            "maxCount": 6
          },
          "74233664-bb9e-11da-ab47-0002b3552d75": {
            "when": "now",
            "hardCount": 4,
            "maxCount": 6
          },
          "b7e1e4c4-34ae-4742-87c3-87d8ca3d8ce6": {
            "when": "2021-06-08 14:00:00 +1000",
            "hardCount": 0,
            "maxCount": 8
          }
        }
      },
      "58c57cdd-0713-11df-9cf0-00151716f9f5": {
        "branches": {
          "2dd57b95-8f47-467a-8e68-26b65d678552": {
            "when": "-",
            "hardCount": 10,
            "maxCount": 19
          },
          "74233664-bb9e-11da-ab47-0002b3552d75": {
            "when": "now",
            "hardCount": 21,
            "maxCount": 35
          },
          "b7e1e4c4-34ae-4742-87c3-87d8ca3d8ce6": {
            "when": "2021-06-06 00:00:00 +1000",
            "hardCount": 7,
            "maxCount": 175
          }
        }
      }
    }
  }
}
```

# Задача: Добавить свойство витринности в запрос получения доступности остатков на филиалах
### Цель:
Просмотр наличия невитринных остатков на конкретном филиале или филиалах.
### Аббревиатуры и сокращения:
- Мягкие остатки - товары, которые можно привезти из других филиалов или из распределительного регионального центра и технопоинта.
- Жесткие остатки - товары, которые есть на филиале на данный момент.
### Описание:
> [!NOTE] v1
> Уходим от функционала "получить товар со склада", формируем единую логику фильтрации исключения витринных образцов в каталоге, корзине и модальном окне наличия, иными словами создаем полноценный режим на сайте - "без витрины".

> [!NOTE] v2
> Уходим от концепции на сайте "Получить товар со склада" и приходим к новой - "Скрыть витринные образцы". Полную информацию о причинах перехода можно изучить в брифе концепции ["Фильтрация витринных образцов"](https://confluence.dns-shop.ru/pages/viewpage.action?pageId=169941588).
> Формируем логику скрытия витринных образцов в каталоге, корзине и модальном окне наличия.
### Задача:

> [!NOTE] v1
> **Необходимо создать вторую версию метода получение остатков по филиалам, который будет принимать параметр витринности.** 

> [!NOTE] v2
> **Необходимо** **создать вторую версию метода ниже без учета параметра дисконтной логистики** **и** **добавить** **новый** **параметр** **учета** **невитринности**.

**Первая версия метода:** http://in-stock-master.hc-k8s.dns-shop.ru/v1/avail
**Запрос**, который **сейчас принимает** первая версия метода:
- массив из guid филиалов
- массив из guid товаров
- булевый параметр дисконтной логистики
**Запрос**, который **должна принимать** вторая версия метода:
- массив из guid филиалов
- массив из guid товаров
- булевый параметр витринности товаров

**Ответ** должен меняться с учетом параметра витринности товара:
- при значении **false** - значения ответа не должны меняться.
- при значении **true**:
	-  Отдавать количество доступного жесткого невитринного остатка.
	-  Отдавать количество доступного мягкого невитринного остатка.