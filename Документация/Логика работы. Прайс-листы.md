# YML
## Бизнес-логика
#### Фиды формируются по следующим параметрам:
- **город (обязательный)** - по данному параметру определяются цены, наличие, акции и т.п.
- **сайт (обязательный)** - по данному параметру определяется скрыт ли товар на сайта, цена товара на сайте, акции и прочее.
- **маркетплейс (обязательный)** - по данному параметру определяется для какого маркетплейса фомируется фид. Для разных маркетплейсов может быть разная логика формирования фидов, но на текущий момент логика формирования одинаковая для всех маркетплейсов.
- **категория товаров (обязательный)** - для формирования фида должна быть выбрана хотя бы одна категория товаров.
- **цена от (опциональный)** - минимальная цена товара, который попадает в фид.
- **цена до (опциональный)** - максимальная цена товара, который попадает в фид.
- **минимальная наценка (опциональный)** - в фид попадут только товары, у которых наценка больше указанной.
- **бренд (опциональный)** - используется для фильтрации товаров в фид по бренду.
- **utm метки (опциональный)** - необходимо для отслеживания успешности размещения на маркетплейсов.

В фидах должны быть товары, которые пользователь может купить на сайте, поэтому **в фиды не должны попадать товары без наличия, цены, скрытые товары**. Наличие подобных товаров грозит баном от маркетплейсов.
[Форма поиска фидов](http://backend.dns-shop.ru/ymlPriceList/yml-price-list/index/)
[Форма создания фидов](http://backend.dns-shop.ru/ymlPriceList/yml-price-list/create/)
## Системная логика
#### Сервис берёт информацию из следующих источников:
- `postgres` (база `dns`, схема `createymlpricelist`).- сервис берёт из базы параметры прайс листов, информация по акциям (описание, сроки), категории, настройки статики для получения изображений.
- `elastik` - сервис из эластика берет информацию по товарам: основные данные, характеристики, наличие, акции,  скрытые товары.
- `redis` - сервис берёт из редиса цены товаров.
- `tarantool` - сервис берёт из тарантула % наценки на товар. Изначально данные по наценки записываются `1С` в `kafka`, сервис читает информацию из кафки и записывает в спейс тарантула. Далее для формирования фида сервис обращается к тарантулу.
После формирования файл архивируется и помещается в хранилище `minio s3.`
Пример наименования файла:
[https://www.dns-shop.ru/pricelist/2gis_dns-shop__Артем_e5d173983ce17b53.zip](https://www.dns-shop.ru/pricelist/2gis_dns-shop__%D0%90%D1%80%D1%82%D0%B5%D0%BC_e5d173983ce17b53.zip)
В название файла включается маркетплейс, сайт по которому формируется фид, город и хеш для уникализации файла.
#### Содержание и структура yml фида
Подробное описание: 
https://confluence.dns-shop.ru/pages/viewpage.action?pageId=73859448
# XML
## Бизнес-логика
#### 
#### 
## Системная логика
#### 
#### 
# yoomoney
## Бизнес-логика
#### 
#### 
## Системная логика
#### 
#### 