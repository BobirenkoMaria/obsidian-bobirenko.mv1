# createYMLPriceList
Создаем прайс лист в формате YML файла.
Сервис создан по начальной заявке 
http://adm-sdms/sdms/#e1cib/data/Документ.ЗаявкаНаРазработку?ref=838600155d03363111ea050c6139c1b5
## Назначение сервиса
Сервис формирует файлы в формате YML c номенклатурными позициями.
Сервис обрабатывает файлы фидов для маркетплейсов: **yamarket**, **2gis**, **retail rocket**
Эти файлы регистрируются на таких сервисах, как: 
яндекс.маркет, 2гис.маркет, retail rocket и пр. сервисами (взявшими за основу YML) 
После такой регистрации маркетплейсы периодически забирают указанные файлы и публикуют наши товару у себя.
 
## Бизнес настройки сервиса
Для указания параметров работы сервиса есть страница настроек в бэкенде сайта dns-shop.ru 
Доступна по адресу https://backend.dns-shop.ru/ymlPriceList/yml-price-list/index/
## Настройка технических параметров работы сервиса
Параметры работы сервиса (строки подключения, таймауты и прочее) задаются в файле config.yaml 
Путь к файлу указывается в параметре configFile в командной строке запуска сервиса
Пример запуска: createYMLPriceList -configFile=config.yaml
Кроме этого варианта, возможна передача параметров через строку запуска и через переменные среды   
За их получение и разбор отвечают функции, собранные в файле config.go
Для конфигурации через переменные среды окружения требуются следующие параметры:
```
SERVEDADDRESS - Обслуживаемый http адрес для отдачи метрик в Прометеус. Например, localhost:8081
PGCONNSTRDNS - Строка подключения к Постгрес
SERVERESURL - URL API экшена, который отдает список адресов серверов Эластика, с указанием имен индексов. В этих индексах лежит информация о товарах в каталоге.
Пример заполнения параметра: https://www.dns-shop.ru/elastic/api/get-index-name/. Из этих результатов мы берем только 
имена индексов, так как адреса серверов отдаются в формате localhost
SERVERES - адрес сервера Эластика, с которого будем получать каталожные товары из индексов, полученных с помощью предыдущего параметра
SLEEPINTERVAL - Перерыв между итерациями формирования
Параметры для работы с Minio
MINIOENDPOINT - Адрес сервиса Minio, например sc-minio2.dns-shop.ru:9075
MINIOKEYID - Ключ доступа к сервису
MINIOSECRET - Секрет для доступа к сервису
MINIOBUCKET - Корзина, куда будем класть файлы. Например, pricelist
MINIOREGION - Регион. Например, us-east-1
MINIOCONTENTTYPE - Тип контента файла. Например, application/zip
```
## Логгирование  
Сервис пишет в Graylog
## Метрики работы
Сервис предоставляет следующие метрики, которые скидывает в Прометеус:
1. кол-во помещенных в файл товаров по каждому магазину по каждому получателю.