actual-date:: 2024-09-04

## Бизнес-логика
Бренд-зоны - раздел сайта, предназначенный для предоставления информации по товарам того или иного производителя (вендора/бренда).
#### На бренд-зонах отображаются следующие блоки контента:
- Баннеры;
- Категории;
- Лучшие предложения:
    - Популярные;
    - Хиты продаж;
    - Обсуждаемые.
- Акции;
- Новинки;
- Отзывы;
- Драйвера и файлы;
- Новости;
- Обзоры;
- Seo-текст для продвижения бренд-зоны в поисковиках.
#### Добавление новых бренд-зон:
Добавляются в [специальном инструменте на редакторской](https://redactor.clubexp.ru/brandZone/brand-zone/index/).
Появление регулируется *Отделом представления товара*.
#### Отображение отдельных блоков:
*Отдел представления товара* ответственен за выбор того, какие блоки и категории будут отображаться на каждой отдельной бренд-зоне.
#### Правила отображения блоков на страницах бренд-зон:
1) Брендзона пустая на сайте, если одновременно отсутствуют данные:  
	- Лучшие предложения  
	- Баннера  
	- Категории  
	- Новинки  
	- Акции
2) Общее правило для всех блоков - в данном виде контента должна быть привязка к товару производителя (т.е. в Новости, акции, в обзоре должен быть прикреплен товар вендора, в категории должны быть товары в наличии, у которых указан данный производитель).
3) Для блоков категории и лучшие предложения - необходимо чтобы товары вендора были в наличии.
4) Для **баннеров** необходимо, чтобы:
	- баннер был опубликован ( установлен чекбокс "Материал опубликован");
	- текущая дата попадала в диапазон дат, когда должен отображаться баннер;
	- была привязка к бренду;
	- баннер не удален (не установлен чекбокс "Материал удалён");
	- баннер отображается в городе, который вы просматриваете или баннер отображается федерально.
	- При попытке загрузить баннер для городов, у которых есть родительский город - баннера не будут отображаться.
	- Для отображения баннеров необходимо загрузить их на родительский город, тогда они будут отображаться также и на дочерних городах.
5) Для **лучших предложений** отображаются товары, у которых:
	- Популярные - наибольшее количество отзывов среди товаров бренда;
	- Хиты продаж - наибольшая сумма продаж по онлайн заказам за последние 3 месяца (аналогичная логика расчета, как в каталоге в сортировке по популярности);
	- Обсуждаемые - наибольшее количество комментариев в коммуникаторе.
6) Для блока **акций**:
	- Акции бренда - акции, к которым привязаны только товары данного бренда. Отображается в том случае, если в настройках бренд-зоны проставлен чек-бокс «Отображать акции бренда», при этом акция опубликована на сайте, не удалена и период её действия в данном городе еще не закончился.
	- Акции с участием других брендов - акции, к которым привязаны товары данного бренда и других производителей. Отображается в том случае, если в настройках бренд-зоны проставлен чек-бокс «Отображать акции с участием других брендов», при этом акция опубликована на сайте, не удалена и период её действия в данном городе еще не закончился.
7) Для блока **отзывы**: 
	- отображается самый популярный отзыв по товарам из категории "Популярные" блока Лучшие предложения.
	- отображаются только "положительные" (не ниже 4*) отзывы – если для товара самый популярный отзыв 3* и ниже, то данный товар пропускаем и отображаем отзыв для следующего товара.
	- учитывается мультикарточка (в Лучших предложениях может отображаться холодильник черного цвета, но отзыв покажем на белы и т. д.).
	- если для некоторого бренда нет товаров в блоке “Популярное”, то необходимо аналогичным образом подтягивать “самые популярные отзывы” из блоков “Хиты продаж” и/или “Обсуждаемые”.
8) Для блока **инструкций и файлов**: 
	- отображаются добавленные файлы/инструкции по связке тип товара + модель товара (из списка).
9) Для блока **обзоры**:
	- обзор прикреплен к бренду  
	- обзор относится к рубрике «Обзоры и тесты». Такие обзоры сортируются в порядке убывания даты публикации (от более новых к поздним). И уже из отсортированного списка отбирается то количество обзоров, которое будет выведено на страницу сайта (указывается в инструменте бэкенда).
## Системная логика
#### Добавление новых бренд-зон:
1) *Создание бренд-зоны в редакторской*
2) *Заполнение обязательных полей (настроек)*
3) *Нажать "Сохранить изменения"*
4) Сохранить бренд зоны в **DB:**
	- **brands.public?.brandzone_categories**
	- **brands.public?.brandzone_cities**
	- **brands.public?.brandzones**
5) **Пересчет** бренд-зоны в каждом городе **и кеширование в Redis**
#### Редактирование бренд-зоны
1) *Выбор бренд-зоны в редакторской*
2) *Редактирование полей (настроек)*
3) *Нажать "Сохранить изменения"*
4) Редактировать бренд зоны в **DB:**
	- **brands.public?.brandzone_categories**
	- **brands.public?.brandzone_cities**
	- **brands.public?.brandzones**
5) **Пересчет** бренд-зоны в каждом городе **и кеширование в Redis**